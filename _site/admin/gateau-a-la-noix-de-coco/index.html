<!DOCTYPE HTML>
<html lang="fr-fr">

  <head>
    <link rel="stylesheet" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css">
    <link href="/proxy/3000/assets/fa/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/proxy/3000/assets/style.css">
    <title>Anne et son admin</title>
    <meta name="generator" content="Eleventy v2.0.1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta property="og:title" content="Anne et son admin">
    <meta property="og:url" content="/admin/{{recette.title|slugify}}/">
      <meta property="" content="og:typewebsite">
    </head>

  <body>
    <div class="backdrop"></div>
        <div class="toolbar">
        <i class="fal fa-save fa-2x" onclick="save()"></i>
    </div>
    <div class="info panel">
        <div>
            <span contenteditable="" class="count fal fa-utensils"></span>
            <span contenteditable="" class="preptime fal fa-hat-chef"></span>
            <span contenteditable="" class="resttime fal fa-snooze"></span>
            <span contenteditable="" class="cooktime fal fa-oven"></span>
        </div>
        <div class="mold">
            <a href="#">
                <img src="https://boutique.guydemarle.com/11017-nq_social_share/moule-flower-power.jpg">
            </a>
            <span class="name" contenteditable="">Moule 12 Flower Power OHRA®</span>
        </div>
    </div>
    <header>
        <h1 contenteditable="">Gâteau à la noix de coco</h1>
    </header>
    <div class="accessories panel">
        <h2>Accessoires</h2>
        <ul></ul>
        <button onclick="addAccessory(true)"><i class="fal fa-plus"></i></button>
    </div>
    <div class="topings panel">
        <h2>Ingrédients</h2>
        <ul>
        </ul>
        <button onclick="addTopings(true)"><i class="fal fa-plus"></i></button>

    </div>
    <div class="steps panel">
        <h2>Préparation</h2>
        <ol>
        </ol>
        <button onclick="addPrepStep(true)"><i class="fal fa-plus"></i></button>
        <span style="position: absolute; bottom:5px; padding-left:24px"><a href="https://www.guydemarle.com/profil/annep_a143-44563">Anne Penin</a>, conseillère Guy Demarle</span>
    </div>
    <div class="logo">
        <img class="qr" src="/proxy/3000/assets/qr_code.svg" style="height:100%">
        <span class="ad">Retrouvez-moi sur facebook </span>
        <a href="https://www.facebook.com/profile.php?id=100090744024852">
            <img src="/proxy/3000/assets/logo.svg" style="height:100%">
        </a>
    </div>

    <script>
        const root=window.location.href.substring(0, window.location.href.length-'/admin/gateau-a-la-noix-de-coco/'.length+'/admin/'.length);
        
        const recipe = {"title":"Gâteau à la noix de coco","topings":[{"quantity":"3","unit":"Oeufs","name":"\n"},{"quantity":"60","unit":"g","name":"Farine"},{"quantity":"125","unit":"cL","name":"Lait"},{"quantity":"125","unit":"cL","name":"Crème fraîche"},{"quantity":"70","unit":"g","name":"Sucre"},{"quantity":"1","unit":"Sachet ","name":"Sucre vanillé"},{"quantity":"60","unit":"g","name":"Noix de coco râpée"},{"quantity":"1","unit":"Pincée de sel","name":""}],"accessories":[{"name":"Plaque Aluminium perforée 40 x 30 cm","picture":"https://boutique.guydemarle.com/2202-nq_social_share/plaque-aluminium-perforee-40-x-30-cm-guy-demarle.jpg","url":""},{"name":"Grand cul de poule 3,7L / 25 cm","picture":"https://boutique.guydemarle.com/2234-nq_social_share/grand-cul-de-poule-37l-25-cm-guy-demarle.jpg","url":"https://boutique.guydemarle.com/accessoires-de-cuisine/684-grand-cul-de-poule-37l-25-cm-guy-demarle.html"},{"name":"Support cul-de-poule","picture":"https://boutique.guydemarle.com/2231-nq_social_share/support-cul-de-poule-guy-demarle.jpg","url":"https://boutique.guydemarle.com/accessoires-de-cuisine/682-support-cul-de-poule-guy-demarle.html"},{"name":"Petit cul de poule 2L / 20 cm","picture":"https://boutique.guydemarle.com/2233-nq_social_share/petit-cul-de-poule-2l-20-cm-guy-demarle.jpg","url":"https://boutique.guydemarle.com/accessoires-de-cuisine/683-petit-cul-de-poule-2l-20-cm-guy-demarle.html"},{"name":"Mini Louche - Rose","picture":"https://boutique.guydemarle.com/9092-nq_social_share/mini-louche-rose-cuisine.jpg","url":"https://boutique.guydemarle.com/accessoires-de-cuisine/3396-mini-louche-rose-cuisine.html"}],"steps":["Poser le moule sur une plaque aluminium perforée.","Séparer les blancs d'œufs des jaunes.","Réserver les blancs.","Dans un petit saladier, mélanger le lait et la crème.","Dans un cul de poule, mettre les jaunes d’oeufs et la farine et mélanger au fouet électrique pour éviter les grumeaux. Ajouter au fur et à mesure le mélange lait/crème sans cesser de battre.","Lorsque le mélange est lisse, ajouter les sucres, puis la noix de coco.","Mélanger énergiquement pour que le mélange redevienne lisse.","Préchauffer le four à 180°C.","Dans un second cul de poule, battre les blancs en neige, avec la pincée de sel, jusqu'à ce qu'ils soient fermes","Ajouter progressivement l’appareil dans les blancs et remuer délicatement.","Verser la préparation obtenue dans le moule flower power à l'aide l'aide la mini-louche pour plus de facilité.","Faire cuire 25 min à 180°C, le temps pourra changer en fonction des fours.","Le dessus du gâteau se colorera en foncé c'est qu'il est cuit.","Laisser refroidir avant de démouler."],"for":"12","preptime":"15 min","resttime":"0","cooktime":"25 min","mold":{"name":"Moule 12 Flower Power OHRA®","picture":"https://boutique.guydemarle.com/11017-nq_social_share/moule-flower-power.jpg","url":"https://dev.dragon-angel.fr/proxy/3000/admin/gateau-a-la-noix-de-coco/#"}};
        document.querySelector('h1').innerText = recipe.title;
        document.querySelector('.info .count').innerText = recipe.for;
        document.querySelector('.info .preptime').innerText = recipe.preptime;
        document.querySelector('.info .resttime').innerText = recipe.resttime;
        document.querySelector('.info .cooktime').innerText = recipe.cooktime;
        document.querySelector('.info .mold>.name').innerText = recipe.mold.name;
        document.querySelector('.info .mold>a>img').src = recipe.mold.picture;
        recipe.topings.forEach(t =>
        {
            const li = addTopings(false);
            li.querySelector('.quantity').innerText = t.quantity;
            li.querySelector('.unit').innerText = t.unit;
            li.querySelector('.toping').innerText = t.name;
        })
        if(recipe.accessories)
            recipe.accessories.forEach(a =>
            {
                const li = addAccessory(false);
                li.querySelector('.name').innerText=a.name;
                li.querySelector('img').src=a.picture;
            })
        recipe.steps.forEach(t =>
        {
            const li = addPrepStep(false);
            li.innerText = t;
        })

        dynamic(document.querySelector('.info>.mold>.name'), {
            Enter(ev)
            {
                fetchmold(ev).then(()=>ev.target.blur());
            }
        })
        document.querySelector('.mold').addEventListener('click', () => document.querySelector('.info>.mold>.name').focus());
        async function fetchmold(ev)
        {
            const res = await fetch(new URL(ev.target.innerText.replace('https://boutique.guydemarle.com', 'boutique'), root));
            const content = res.text();
            const dummy = document.createElement('div');
            dummy.innerHTML = await content;
            const meta = Object.fromEntries(Array.from(dummy.querySelectorAll('meta').values()).filter(v => v.attributes.property).map(v => [v.attributes.property.value, v.attributes.content.value]));
            dummy.remove();
            ev.target.innerText = meta['og:title'];
            ev.target.parentNode.querySelector('img').src = meta['og:image'];
            ev.target.parentNode.querySelector('a').href = meta['og:url'];
        }

        function save()
        {
            const recipe = {
                title: document.querySelector('h1').innerText,
                topings: Array.from(document.querySelectorAll('.topings li')).map(li => ({
                    quantity: li.querySelector('.quantity').innerText,
                    unit: li.querySelector('.unit').innerText,
                    name: li.querySelector('.toping').innerText
                })),
                accessories:Array.from(document.querySelectorAll('.accessories > ul > li')).map(span=>({
                    name: span.querySelector('.name').innerText,
                    picture: span.querySelector('img').src,
                    url: span.querySelector('a').href,
                })),
                steps: Array.from(document.querySelectorAll('.steps li')).map(li => li.innerText),
                for: document.querySelector('.info .count').innerText,
                preptime: document.querySelector('.info .preptime').innerText,
                resttime: document.querySelector('.info .resttime').innerText,
                cooktime: document.querySelector('.info .cooktime').innerText,
                mold:{
                    name: document.querySelector('.info>.mold').innerText, 
                    picture:document.querySelector('.info>.mold>a>img').src,
                    url:document.querySelector('.info>.mold>a').href,
                },
            };

            fetch(window.location.href, { method: 'POST', body: JSON.stringify(recipe), headers: { 'Content-Type': 'application/json' } });
        }

        function addAccessory(focus)
        {
            const li = document.createElement('li')
            li.classList.add('mold');
            const a = document.createElement('a');
            a.target='_blank';
            li.appendChild(a);
            const img=document.createElement('img');
            a.appendChild(img);
            const name = document.createElement('span')
            name.classList.add('name');
            name.contentEditable=true;
            li.appendChild(name);
            document.querySelector('.accessories>ul').appendChild(li);
            dynamic(name, { Enter:(ev) => {
                if(ev.target.innerText!=='')
                    fetchmold(ev).then(()=>ev.target.blur());
                else
                    li.remove();
            } });
            if (focus)
                name.focus();
            return li;
        }

        function addPrepStep(focus)
        {
            const li = document.createElement('li')
            li.contentEditable = true;
            document.querySelector('.steps ol').appendChild(li);
            dynamic(li);
            if (focus)
                li.focus();
            return li;
        }

        function addTopings(focus)
        {
            const li = document.createElement('li')
            const quantity = document.createElement('span')
            const unit = document.createElement('span')
            const toping = document.createElement('span')
            quantity.classList.add('quantity');
            unit.classList.add('unit');
            toping.classList.add('toping');
            quantity.contentEditable = true;
            unit.contentEditable = true;
            toping.contentEditable = true;
            li.appendChild(quantity);
            li.appendChild(unit);
            li.appendChild(toping);
            // li.contentEditable = true;
            document.querySelector('.topings ul').appendChild(li);
            dynamic(quantity, { Enter(ev) { unit.focus(); ev.preventDefault(); return false } })
            dynamic(unit, { Enter(ev) { toping.focus(); ev.preventDefault(); return false } })
            dynamic(toping, { Enter(ev) { toping.blur(); setTimeout(() => addTopings(true)); ev.preventDefault(); return false } });
            if (focus)
                quantity.focus();
            return li;
        }

        function dynamic(self, keys)
        {
            keys = Object.assign({}, keys);
            self.addEventListener('keydown', function (ev)
            {
                if (self.innerText === '' && (ev.key == 'Delete' || ev.key == 'Backspace' || ev.key == 'Escape'))
                {
                    self.blur();
                }
                //else if (this.innerText === '' && ev.key.length > 1 && ev.key !== 'Unidentified')
                //    self.innerText = ev.key;
                else if (ev.key in keys)
                    keys[ev.key](ev);
            });
            self.addEventListener('blur', function (ev)
            {
                let li = self;
                while (li && li.tagName !== 'LI')
                    li = li.parentNode;

                if (li && li.textContent == '')
                    li.remove();
            });
        }
    </script>
  </body>

</html>